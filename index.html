<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Retirement Insight Form</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
    body {
      margin: 0;
      padding: 2rem;
      font-family: 'Inter', sans-serif;
      background: #f0f2f5;
      color: #1e2a45;
      font-size: 18px;
      line-height: 1.6;
    }
    .card {
      max-width: 640px;
      margin: 0 auto;
      background: #ffffff;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.06);
    }
    .logo {
      display: block;
      max-width: 160px;
      margin: 0 auto 2rem;
    }
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.5rem;
      font-size: 18px;
    }
    .field {
      margin-bottom: 1.5rem;
    }
    input[type="text"], input[type="email"], input[type="tel"], select, textarea {
      width: 100%;
      padding: 1rem;
      font-size: 1.125rem;
      border: 2px solid #ccd1da;
      border-radius: 6px;
      background: #fcfcfc;
      resize: vertical;
      box-sizing: border-box;
    }
    textarea {
      min-height: 100px;
    }
    select {
      font-size: 20px;
      font-weight: 600;
    }
    input[type="range"] {
      -webkit-appearance: none;
      width: 100%;
      height: 8px;
      border-radius: 4px;
      background: #e1e4e8;
      outline: none;
      accent-color: #2a73d2;
      margin-top: 0.5rem;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      background: #2a73d2;
      border-radius: 50%;
      cursor: pointer;
      border: none;
    }
    .slider-value {
      text-align: right;
      font-size: 18px;
      font-weight: 600;
      margin-top: 0.25rem;
      color: #1e2a45;
    }
    .generate-btn {
      display: block;
      width: 100%;
      padding: 0.75rem;
      font-size: 20px;
      font-weight: 600;
      color: #fff;
      background-color: #2a73d2;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s;
      margin-top: 1rem;
    }
    .generate-btn:hover {
      background-color: #225bb5;
    }
    #loadingOverlay {
      position: fixed;
      inset: 0;
      background: rgba(255,255,255,0.9);
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 999;
      text-align: center;
      padding: 1rem;
    }
    #loadingOverlay .spinner {
      border: 4px solid rgba(0,0,0,0.1);
      border-top: 4px solid #2a73d2;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      animation: spin 1s linear infinite;
      margin-bottom: 1rem;
    }
    #loadingTip {
      font-size: 16px;
      max-width: 80%;
      line-height: 1.4;
    }
    #encouragement {
      color: #2a73d2;
      font-size: 16px;
      text-align: center;
      margin-bottom: 1.5rem;
    }
    #summaryText {
      background: #fdfdfd;
      border: 1px solid #e0e7ff;
      border-radius: 12px;
      padding: 2.5rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
      white-space: pre-line;
      width: 100%;
      box-sizing: border-box;
      text-align: left;
      line-height: 1.7;
      font-size: 16px;
      margin-top: 1rem;
    }
    #insightContainer, #followUpWrapper {
      width: 100%;
      box-sizing: border-box;
      margin: 2rem 0;
      padding: 0;
    }
    #insightContainer {
      margin-top: 3rem;
    }
    #followUpWrapper {
      margin-top: 3rem;
    }
    #followUpWrapper .field,
    #insightContainer .field {
      margin-bottom: 2rem;
      padding: 0;
    }
    #questionAnswerPairs {
      margin-bottom: 3rem;
    }
    #questionAnswerPairs .field {
      background: #fafafa;
      padding: 1.5rem;
      border-radius: 8px;
      margin-bottom: 2rem;
      border-left: 4px solid #2a73d2;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div id="loadingOverlay">
    <div class="spinner"></div>
    <div id="loadingTip">Tip: Even small early contributions can double in 20 years!</div>
  </div>

  <div class="card">
    <img class="logo" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRdpOB-6Tz3kYJsMfhrs7LJF05khXT3Zl6YUg&s" alt="E.H. Howard Logo">
    
    <div style="text-align: center; margin-bottom: 2rem;">
      <h1 style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem; color: #1e2a45;">Get Your Free Retirement Plan</h1>
      <p style="font-size: 1.125rem; color: #666; margin-bottom: 1rem;">See exactly where you stand in under 2 minutes</p>
      <p style="font-size: 0.875rem; color: #2a73d2; font-weight: 600;">✓ Already trusted by 100+ households</p>
    </div>

    <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; text-align: center;">
      <p style="margin: 0; font-size: 16px; color: #1e2a45;"><strong>Step 1 of 2:</strong> Basic Information</p>
    </div>

    <form id="retirementForm" autocomplete="on">
      <div class="field">
        <label for="Name">Your Name</label>
        <input type="text" id="Name" name="Name" placeholder="e.g. Taylor Swift" required />
      </div>

      <div class="field">
        <label for="Age">Your Age</label>
        <input type="range" id="Age" name="Age" min="18" max="80" value="30" oninput="ageVal.innerText=this.value" />
        <div class="slider-value">Age: <span id="ageVal">30</span></div>
      </div>

      <div class="field">
        <label for="Income">Annual Income ($)</label>
        <input type="range" id="Income" name="Income" min="10000" max="300000" step="1000" value="50000" oninput="incomeVal.innerText=Number(this.value).toLocaleString()" />
        <div class="slider-value">$<span id="incomeVal">50,000</span></div>
      </div>

      <div class="field">
        <label for="Savings">Retirement Savings ($)</label>
        <input type="range" id="Savings" min="0" max="100" step="1" value="20"
          oninput="let val = Math.round(((Math.pow(5, this.value / 30) - 1) * 15000) / 100) * 100;
                   savingsVal.innerText = val.toLocaleString();
                   document.getElementById('RealSavings').value = val;" />
        <div class="slider-value">$<span id="savingsVal">100,000</span></div>
        <input type="hidden" id="RealSavings" name="Savings" />
      </div>

      <div class="field">
        <label for="RetireAge">Desired Retirement Age</label>
        <input type="range" id="RetireAge" name="RetireAge" min="50" max="80" value="60" oninput="retireVal.innerText=this.value" />
        <div class="slider-value">Age: <span id="retireVal">60</span></div>
      </div>

      <div class="field">
        <label for="lifestyle">Lifestyle Goal</label>
        <select id="lifestyle" name="lifestyle" required>
          <option value="modest">Modest</option>
          <option value="comfortable">Comfortable</option>
          <option value="luxury">Luxury</option>
        </select>
      </div>

      <div class="field">
        <label for="userPhone">Phone (required)</label>
        <div style="display: flex; gap: 0.5rem;">
          <select id="countryCode" name="countryCode" style="width: 120px; flex-shrink: 0;">
            <option value="+1">🇺🇸 +1</option>
            <option value="+44">🇬🇧 +44</option>
            <option value="+33">🇫🇷 +33</option>
            <option value="+49">🇩🇪 +49</option>
            <option value="+39">🇮🇹 +39</option>
            <option value="+34">🇪🇸 +34</option>
            <option value="+31">🇳🇱 +31</option>
            <option value="+32">🇧🇪 +32</option>
            <option value="+41">🇨🇭 +41</option>
            <option value="+43">🇦🇹 +43</option>
            <option value="+61">🇦🇺 +61</option>
            <option value="+64">🇳🇿 +64</option>
            <option value="+1">🇨🇦 +1</option>
          </select>
          <input type="tel" id="userPhone" name="userPhone" placeholder="555-123-4567" required style="flex: 1;" />
        </div>
      </div>

      <button type="submit" class="generate-btn">Generate My FREE Insight</button>
      <input type="text" name="website" id="website" style="display:none;" autocomplete="off" tabindex="-1">
    </form>

    <div id="insightContainer" class="field" style="display: none;">
      <label style="font-size: 20px; color: #1e2a45; margin-bottom: 1rem;">🎯 Your Retirement Plan:</label>
      <div id="summaryText"></div>
    </div>

    <div id="followUpWrapper" style="display: none;">
      <div style="text-align: center; margin-bottom: 2rem;">
        <h2 style="font-size: 1.75rem; font-weight: 700; margin-bottom: 0.5rem; color: #1e2a45;">
          Help Us Personalize Your Plan
        </h2>
        <p style="font-size: 1rem; color: #666;">Answer these optional questions for more targeted advice</p>
      </div>
      
      <div id="questionAnswerPairs">
        <!-- Questions and answers will be populated here dynamically -->
      </div>

      <div style="margin-top: 2rem; padding: 2rem; background: #f8f9fa; border-radius: 12px; text-align: center;">
        <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; color: #1e2a45;">
          Get Your FREE Retirement Plan
        </h3>
        <p style="font-size: 1rem; color: #666; margin-bottom: 1.5rem;">Enter your email to receive your personalized plan</p>
        
        <div class="field">
          <div style="position: relative; max-width: 400px; margin: 0 auto;">
            <input type="email" id="userEmail" name="userEmail" placeholder="you@example.com" required style="padding-right: 50px;" />
            <div style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); font-size: 12px; color: #28a745;">
              🔒 SSL
            </div>
          </div>
          <p style="font-size: 12px; color: #666; margin: 0.5rem 0 1rem 0;">100% Private & Secure • No spam, ever</p>
        </div>

        <button id="submitFollowUps" class="generate-btn" style="max-width: 400px; margin: 0 auto;">Send My FREE Plan</button>
      </div>
    </div>
  </div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Initialize the savings value on page load
    const savingsSlider = document.getElementById('Savings');
    const initialSavingsValue = Math.round(((Math.pow(5, savingsSlider.value / 30) - 1) * 15000) / 100) * 100;
    document.getElementById('RealSavings').value = initialSavingsValue;
    document.getElementById('savingsVal').innerText = initialSavingsValue.toLocaleString();

    // Classic celebrity names boomers and Gen X would recognize and love
    const celebrities = [
      // Classic Boomers (60s-80s icons)
      'Paul McCartney', 'Barbra Streisand', 'Robert De Niro', 'Meryl Streep',
      'Harrison Ford', 'Diane Keaton', 'Al Pacino', 'Jane Fonda',
      'Robert Redford', 'Sally Field', 'Jack Nicholson', 'Goldie Hawn',
      'Dustin Hoffman', 'Cher', 'Warren Beatty', 'Faye Dunaway',
      'Gene Hackman', 'Shirley MacLaine', 'Clint Eastwood', 'Helen Mirren',
      'Michael Douglas', 'Susan Sarandon', 'Morgan Freeman', 'Jessica Lange',
      'Kevin Costner', 'Glenn Close', 'Sean Connery', 'Kathleen Turner',
      'John Travolta', 'Sigourney Weaver', 'Richard Gere', 'Sissy Spacek',
      // Additional Boomer legends
      'Sylvester Stallone', 'Diane Sawyer', 'Steven Spielberg', 'Bette Midler',
      'Robin Williams', 'Whoopi Goldberg', 'Danny DeVito', 'Kathy Bates',
      'Billy Joel', 'Elton John', 'Diana Ross', 'Dolly Parton',
      'Bruce Springsteen', 'Tina Turner', 'Stevie Nicks', 'Rod Stewart',
      // Gen X favorites (80s-90s stars)
      'Tom Cruise', 'Julia Roberts', 'Denzel Washington', 'Michelle Pfeiffer',
      'Kevin Bacon', 'Meg Ryan', 'Matthew Broderick', 'Molly Ringwald',
      'Tom Hanks', 'Sandra Bullock', 'Keanu Reeves', 'Winona Ryder',
      'Will Smith', 'Jennifer Aniston', 'Brad Pitt', 'Gwyneth Paltrow',
      'George Clooney', 'Angelina Jolie', 'Leonardo DiCaprio', 'Drew Barrymore',
      'Jim Carrey', 'Cameron Diaz', 'Ben Stiller', 'Jennifer Lopez',
      'Matt Damon', 'Reese Witherspoon', 'Owen Wilson', 'Sarah Jessica Parker'
    ];
    
    const nameInput = document.getElementById('Name');
    
    // Set initial random celebrity
    const randomCelebrity = celebrities[Math.floor(Math.random() * celebrities.length)];
    nameInput.placeholder = `e.g. ${randomCelebrity}`;
    
    // Change placeholder every 3 seconds when field is empty
    let placeholderInterval = setInterval(() => {
      if (nameInput.value === '') {
        const newCelebrity = celebrities[Math.floor(Math.random() * celebrities.length)];
        nameInput.placeholder = `e.g. ${newCelebrity}`;
      }
    }, 3000);
    
    // Stop changing placeholder when user starts typing
    nameInput.addEventListener('input', () => {
      if (nameInput.value !== '') {
        clearInterval(placeholderInterval);
      } else {
        // Restart if they clear the field
        placeholderInterval = setInterval(() => {
          if (nameInput.value === '') {
            const newCelebrity = celebrities[Math.floor(Math.random() * celebrities.length)];
            nameInput.placeholder = `e.g. ${newCelebrity}`;
          }
        }, 3000);
      }
    });

    const form = document.getElementById('retirementForm');
    const overlay = document.getElementById('loadingOverlay');
    const tipEl = document.getElementById('loadingTip');
    const tips = [
      'Even small contributions now can double in 20 years.',
      'Max out your 401(k) match—instant 100% return!',
      'Rebalance annually to stay on-track with your goals.',
      'Delay Social Security for ~8% extra per year.',
      'Review your allocation every 2 years for risk comfort.'
    ];

    form.addEventListener('submit', async e => {
      e.preventDefault();
      overlay.style.display = 'flex';
      let idx = 0;
      tipEl.innerText = tips[idx];
      const interval = setInterval(() => {
        idx = (idx + 1) % tips.length;
        tipEl.innerText = tips[idx];
      }, 4000);

      const formData = new FormData(form);
      formData.set("Savings", document.getElementById("RealSavings").value);
      const payload = Object.fromEntries(formData.entries());

      try {
        const res = await fetch('https://liammatthes.app.n8n.cloud/webhook/Retirement-form', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        const data = await res.json();
        const { summary, questions } = Array.isArray(data) ? data[0] : data;

        document.getElementById('summaryText').innerText = summary || '';
        document.getElementById('insightContainer').style.display = 'block';

        const questionContainer = document.getElementById('questionAnswerPairs');
        if (questionContainer && Array.isArray(questions)) {
          questionContainer.innerHTML = '';
          questions.forEach((q, index) => {
            const fieldDiv = document.createElement('div');
            fieldDiv.className = 'field';
            
            const label = document.createElement('label');
            label.setAttribute('for', `response${index + 1}`);
            label.innerText = q;
            
            const textarea = document.createElement('textarea');
            textarea.id = `response${index + 1}`;
            textarea.placeholder = `Your answer here... (Optional)`;
            
            fieldDiv.appendChild(label);
            fieldDiv.appendChild(textarea);
            questionContainer.appendChild(fieldDiv);
          });
          document.getElementById('followUpWrapper').style.display = 'block';
        }

        clearInterval(interval);
        overlay.style.display = 'none';
      } catch (err) {
        clearInterval(interval);
        overlay.style.display = 'none';
        console.error('❌ Error:', err);
        alert('Error generating insight; please try again.');
      }
    });

    document.getElementById('submitFollowUps').addEventListener('click', async () => {
      const botTrap = document.getElementById('website').value;
      if (botTrap) return;

      // Collect answers from dynamically created textareas
      const answers = {};
      const questionContainer = document.getElementById('questionAnswerPairs');
      if (questionContainer) {
        const textareas = questionContainer.querySelectorAll('textarea');
        textareas.forEach((textarea, index) => {
          answers[`answer${index + 1}`] = textarea.value.trim() || null;
        });
      }
      const email = document.getElementById('userEmail').value.trim();
      const phone = document.getElementById('userPhone').value || '';
      const countryCode = document.getElementById('countryCode').value || '+1';
      const savings = parseFloat(document.getElementById('RealSavings').value) || 0;

      if (!email) {
        alert('Please enter your email so we can send your plan.');
        return;
      }

      try {
        const res = await fetch('https://liammatthes.app.n8n.cloud/webhook/1f0ba9d4-502d-4a60-b4e9-ee7e1d9a1040', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            ...answers,
            email,
            phone: countryCode + phone,
            name: document.getElementById('Name').value,
            age: document.getElementById('Age').value,
            income: document.getElementById('Income').value,
            savings,
            retireAge: document.getElementById('RetireAge').value,
            lifestyle: document.getElementById('lifestyle').value,
            summary: document.getElementById('summaryText').innerText,
            timestamp: new Date().toISOString()
          })
        });

        if (res.ok) {
          alert('✅ Your retirement plan is on the way!');
        } else {
          alert('❌ Submission failed. Please try again.');
        }
      } catch (err) {
        console.error('❌ Follow-up error:', err);
        alert('Could not send your answers. Try again later.');
      }
    });
  });
</script>

</body>
</html>
